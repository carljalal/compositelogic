<html>
<head>
<style>
body {
    font-family: Verdana, Geneva, Tahoma, sans-serif;
    font-size: medium;
}
</style>
</head>
<body>
<script>

let boardParent = null;
let trainingTitle = null;
let questionDiv = null;
let answerDiv = null;
let trueButton = null;
let falseButton = null;
let startButton = null;
let statsParent = null;
let feedbackDiv = null;
let statsDiv = null;
let numCorrectDiv = null;
let numIncorrectDiv = null;

let trainingStats = {
    numCorrect: 0,
    numIncorrect: 0
};

let currentQuestion = {
    question:null,
    answer:null
};

let currentAnswer = {
    answer:null
}

let logicSymbols = [
    {name: " and "  , evaluate: function (a,b){if(a && b) {return true;} else {return false;}}},
    {name: " or "   , evaluate: function (a,b){if(a || b) {return true;} else {return false;}}},
    {name: " xor "  , evaluate: function (a,b){if((!a && b) || (a && !b)) {return true;} else {return false;}}},
    {name: " nor "  , evaluate: function (a,b){if(!a && !b) {return true;} else {return false;}}},
    {name: " imply ", evaluate: function (a,b){if(a && !b) {return false;} else {return true;}}},
    {name: " xnor " , evaluate: function (a,b){if((a && b) || (!a && !b)) {return true;} else {return false;}}},
    {name: " nand " , evaluate: function (a,b){if(a && b) {return false;} else {return true;}}},
    {name: "not "   , evaluate: function (a){if(!a) {return true;} else {return false;}}},
    
];

let trueFalseSymbols = [
    {name: "true"   , evaluate: function (){return true;}},
    {name: "false"  , evaluate: function (){return false;}}
]

class logicNode {
    constructor(){
        this.left = null;
        this.right = null;
        this.symbol = null;
        this.truth = null;
    }
}



function fillLogicTreePiece(o){
    if(randBool(.2)){
        o.symbol = randItem(logicSymbols);
        fillLeaves(o);
    }
    else{
        o.symbol = randItem(trueFalseSymbols);
    }
}

function fillLeaves(o){
    if(o.symbol.name == "true") return;
    else if(o.symbol.name == "false") return;
    else if(o.symbol.name == "not "){
        o.right = new logicNode();
        fillLogicTreePiece(o.right);
    }
    else {
        o.left = new logicNode();
        o.right = new logicNode();
        fillLogicTreePiece(o.left);
        fillLogicTreePiece(o.right);
    }
}

function fillLogicTree(){
    let iterations = Math.floor(Math.random()*10);

    let tree = new logicNode();
    tree.symbol = randItem(logicSymbols);
    
    fillLeaves(tree);
    evaluateTree(tree);
    return tree;
}



function evaluateTree(o){
    let l = null;
    let r = null;
    if(o.symbol.name == "true"){
        o.text = o.symbol.name;
        o.truth = o.symbol.evaluate();
    }
    else if(o.symbol.name == "false"){
        o.text = o.symbol.name;
        o.truth = o.symbol.evaluate();
    }
    else if(o.symbol.name == "not "){
        r = evaluateTree(o.right);
        o.truth = o.symbol.evaluate(r);
        o.text = "(" + o.symbol.name + o.right.text + ")";
    }
    else {
        l = evaluateTree(o.left);
        r = evaluateTree(o.right);
        o.truth = o.symbol.evaluate(l,r);
        o.text = "(" + o.left.text + o.symbol.name + o.right.text + ")";
    }
    return o.truth;
}


function startUp(){
    boardParent = prepareDiv();

    trainingTitle = "logic training";
    questionDiv = prepareDiv(boardParent);

    appendBreak(boardParent);
    answerDiv = prepareInput(boardParent);
    trueButton = prepareDiv(boardParent);
    falseButton = prepareDiv(boardParent);
    appendBreak();
    appendBreak();
    startButton = prepareDiv();

    styleButton(startButton);
    styleButton(trueButton);
    greenColor(trueButton)
    styleButton(falseButton);
    redColor(falseButton);
    styleQuestionButton(startButton);
    styleQuestionDiv(questionDiv);

    statsParent = prepareDiv();
    feedbackDiv = prepareDiv(statsParent);
    statsDiv = prepareDiv(statsParent);
    styleBoardParent(statsParent);
    styleStatsParent(statsParent);

    numCorrectDiv = prepareDiv(statsParent);
    numIncorrectDiv = prepareDiv(statsParent);
}


function styleBoardParent(o) {
    o.style.display = "none";
    o.style.border = "2px solid black";
    o.style.padding = "5px";
}

function styleStatsParent(o) {
    
}

function appendBreak(parent = document.body){
    parent.append(document.createElement("br"));
}

function prepareDiv(parent = document.body){
    let o = document.createElement("div")
    parent.append(o);
    return o;
}

function styleQuestionDiv(o) {
    o.style.fontStyle = "italic";
    o.style.backgroundColor = "pink";
    o.style.padding = "3px"
    o.style.fontSize = "20";
    o.style.display = "inline-block";
}

function greenColor(o){
    o.style.backgroundColor = "lime";
    o.innerHTML = "<b>true</b>";
    o.style.display = "none";
}

function redColor(o){
    o.style.backgroundColor = "red";
    o.innerHTML = "<b>false</b>";
    o.style.display = "none";
}


function prepareInput(parent = document.body){
    let o = document.createElement("input");
    parent.append(o);
    o.style.display = 'none';
    return o;
}

function styleButton(o){
    o.style.width = 80;
    o.style.height = 20;
    o.style.border = "2px solid black";
    o.style.padding = "3px";
}

function styleQuestionButton(o){
    o.innerHTML = "<b>start</b>"
    o.style.fontSize = "20";
}

function getAnswer(){
    if (currentAnswer.answer != null){
        return currentAnswer.answer.toString();
    }
    else return answerDiv.value;
}

function randBool(rateTrue = 0.5){
    if(Math.random() < rateTrue) return true;
    else return false;
}

function randItem(o){
    return o[Math.floor(Math.random()*o.length)];
}


function prepareQuestion(){
    let tree = fillLogicTree();

    currentQuestion = {};
    currentQuestion.question = tree.text;
    currentQuestion.answer = tree.truth;
}

function displayQuestion() {
    questionDiv.innerHTML = currentQuestion.question;
}

function clearFeedback(){
    feedbackDiv.innerHTML = "";
}

function clearAnswerInput(){
    if(answerDiv.value == ""){
        return false;
    }
    else{
        answerDiv.value = "";
        return true;
    }
}

function updateScore(s){
    if(s == "correct"){
        trainingStats.numCorrect++;
        
    }
    if(s == "incorrect") {
        trainingStats.numIncorrect++;
    }
    numCorrectDiv.innerHTML = "correct: " + traininStats.numCorrect;
    numIncorrectDiv.innerHTML = "incorrect: " + traininStats.numIncorrect;
}

function feedbackCorrect(){
    feedbackDiv.innerHTML += "yes it is correct!";
    updateScore("correct");
}

function feedbackIncorrect(){
    feedbackDiv.innerHTML += "correct answer was " + currentQuestion.answer;
    updateScore("incorrect");
}

function feedbackFirstQuestion(){
    feedbackDiv.innerHTML += "here's your first question!";
}

function handleAnswer() {
    clearFeedback();

    if(currentQuestion.answer == null){
        feedbackFirstQuestion();
        return;
    }
    
    if(currentQuestion.answer.toString() == getAnswer()) {
        feedbackCorrect();
    }
    else{
        feedbackIncorrect();
    }
}


function nextQuestion() {
    handleAnswer();
    clearAnswerInput();
    prepareQuestion();
    displayQuestion();
}

startButton.onclick = () => {
    nextQuestion();
    startButton.style.display = "none";
    boardParent.style.display = "inline-block";
    trueButton.style.display = "inline-block";
    falseButton.style.display = "inline-block";
}

answerDiv.addEventListener("keypress", (e)=> {
    if(e.key == "Enter") {
        nextQuestion();
    }
});

trueButton.addEventListener("click", () => {
    currentAnswer.answer = true;
    nextQuestion();
    currentAnswer.answer = null;
})

falseButton.addEventListener("click", () => {
    currentAnswer.answer = false;
    nextQuestion();
    currentAnswer.answer = null;
})

startUp();

</script>
</body>
</html>